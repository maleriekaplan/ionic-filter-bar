angular.module("jett.ionic.filter.bar",["ionic"]),function(e){"use strict";e.module("jett.ionic.filter.bar").directive("ionFilterBar",["$document","$timeout","$ionicGesture","$ionicPlatform",function(t,n,r,i){var o;return o=i.is("android")?'<div class="filter-bar-wrapper filter-bar-{{::config.theme}} filter-bar-transition-{{::config.transition}}"><div class="bar bar-header bar-{{::config.theme}} item-input-inset"><button class="filter-bar-cancel button button-icon icon {{::config.back}}"></button><form ng-submit="update" class="item-input-wrapper"><input type="search" class="filter-bar-search" ng-model="filterText" placeholder="{{::config.placeholder}}" /><button style="display:none;" class="filter-bar-clear button button-icon icon {{::config.clear}}"></button></form></div></div>':'<div class="filter-bar-wrapper filter-bar-{{::config.theme}} filter-bar-transition-{{::config.transition}}"><div class="bar bar-header bar-{{::config.theme}} item-input-inset"><form ng-submit="update" class="item-input-wrapper"><i class="icon {{::config.search}} placeholder-icon"></i><input type="search" class="filter-bar-search" ng-model="filterText" placeholder="{{::config.placeholder}}"/><button style="display:none;" class="filter-bar-clear button button-icon icon {{::config.clear}}"></button></form><button class="filter-bar-cancel button button-clear" ng-bind-html="::cancelText"></button></div></div>',{restrict:"E",scope:!0,link:function(i,o){var a,c,l,s,f,u=e.element(o[0].querySelector(".filter-bar-clear")),d=e.element(o[0].querySelector(".filter-bar-cancel")),p=o.find("input"),m=o.find("form");i.filterText||(i.filterText="");var b=function(){i.cancelFilterBar()},h=function(){i.updateWithReturnKey&&(i.updateSearch(i.filterText),i.hideBackdrop())};d.bind("click",b),m.bind("submit",h),i.$on("$stateChangeStart",function(){i.cancelFilterBar()}),i.config.backdrop&&(l=e.element('<div class="filter-bar-backdrop"></div>'),o.append(l),s=function(e){e.target==l[0]&&b()},l.bind("click",s),c=r.on("swipe",s,l));var g=function(){"none"===u.css("display")&&u.css("display","block")},v=function(){"block"===u.css("display")&&u.css("display","none")},B=function(){n(function(){i.filterText="",v(),ionic.requestAnimationFrame(function(){i.showBackdrop(),i.scrollItemsTop(),i.focusInput()})})};u.bind("touchstart mousedown",B),p.bind("touchstart mousedown",function(){i.scrollItemsTop(),i.focusInput()});var k=function(e){27==e.which?b():i.filterText&&i.filterText.length?(g(),i.updateWithReturnKey||i.hideBackdrop()):(v(),i.showBackdrop())};t.bind("keyup",k);var y=function(){i.filterItems(i.filterText)};i.$on("$destroy",function(){o.remove(),t.unbind("keyup",k),l&&r.off(c,"swipe",s),i.updateWithReturnKey||f()}),i.updateWithReturnKey||(f=i.$watch("filterText",function(e,t){var r;a&&n.cancel(a),e!==t&&(console.log("searching"),r=e.length&&i.debounce?i.delay:0,a=n(y,r,!1))}))},template:o}}])}(angular),function(e){"use strict";e.module("jett.ionic.filter.bar").provider("$ionicFilterBarConfig",function(){function t(e,t){c.platform[e]=t,o.platform[e]={},n(c,c.platform[e]),r(c.platform[e],o.platform[e],"")}function n(t,r){for(var i in t)i!=a&&t.hasOwnProperty(i)&&(e.isObject(t[i])?(e.isDefined(r[i])||(r[i]={}),n(t[i],r[i])):e.isDefined(r[i])||(r[i]=null))}function r(t,n,o){e.forEach(t,function(l,s){e.isObject(t[s])?(n[s]={},r(t[s],n[s],o+"."+s)):n[s]=function(e){if(arguments.length)return t[s]=e,n;if(t[s]==a){var r=i(c.platform,ionic.Platform.platform()+o+"."+s);return r||r===!1?r:i(c.platform,"default"+o+"."+s)}return t[s]}})}function i(t,n){n=n.split(".");for(var r=0;r<n.length;r++){if(!t||!e.isDefined(t[n[r]]))return null;t=t[n[r]]}return t}var o=this;o.platform={};var a="platform",c={theme:a,clear:a,search:a,backdrop:a,transition:a,platform:{},placeholder:a};r(c,o,""),t("default",{clear:"ion-ios-close",search:"ion-ios-search-strong",backdrop:!0,transition:"vertical",placeholder:"Search"}),t("ios",{}),t("android",{clear:"ion-android-close",search:!1,backdrop:!1,transition:"horizontal"}),o.setPlatformConfig=t,o.$get=function(){return o}})}(angular),function(e,t){"use strict";var n=function(e){var t=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],n=e&&e.classList;if(n)for(var r=0;r<t.length;r++)if(n.contains("bar-"+t[r]))return t[r]};e.module("jett.ionic.filter.bar").factory("$ionicFilterBar",["$document","$rootScope","$compile","$timeout","$filter","$ionicPlatform","$ionicFilterBarConfig","$ionicConfig","$ionicScrollDelegate",function(r,i,o,a,c,l,s,f,u){function d(r){if(!p){p=!0,r=r||{};var s=i.$new(!0),f=!0,d=!1;r.container&&(r.container=e.element(m[0].querySelector(r.container))),e.extend(s,{config:b,$deregisterBackButton:e.noop,update:e.noop,cancel:e.noop,done:e.noop,scrollDelegate:u,filter:c("filter"),filterProperties:null,expression:null,comparator:null,debounce:!0,delay:300,cancelText:"Cancel",cancelOnStateChange:!0,container:m,updateWithReturnKey:!1,filterText:""},r),s.config.theme||(s.config.theme=n(s.container[0].querySelector(".bar.bar-header")));var h=s.element=o('<ion-filter-bar class="filter-bar"></ion-filter-bar>')(s),g=h.children().eq(0),v=g.find("input")[0],B=h.children().eq(1),k=s.scrollDelegate.getScrollView(),y=!!k,$=y?e.element(k.__container):null,T=s.cancelOnStateChange?i.$on("$stateChangeSuccess",function(){s.cancelFilterBar()}):e.noop,w=function(){d||(d=!0,v&&v.focus())},F=function(){d&&(d=!1,v&&v.blur())},x=function(){k.__scrollTop>0&&F()};return s.scrollItemsTop=function(){y&&s.scrollDelegate.scrollTop&&s.scrollDelegate.scrollTop()},s.focusInput=function(){d=!1,w()},s.hideBackdrop=function(){B.length&&f&&(f=!1,B.removeClass("active").css("display","none"))},s.showBackdrop=function(){B.length&&!f&&(f=!0,B.css("display","block").addClass("active"))},s.filterItems=function(t){var n,r;t.length?(s.expression?n=s.expression:e.isArray(s.filterProperties)?(n={},e.forEach(s.filterProperties,function(e){n[e]=t})):s.filterProperties?(n={},n[s.filterProperties]=t):n=t,r=s.filter(s.items,n,s.comparator)):r=s.items,a(function(){s.update(r,t),s.scrollItemsTop()})},s.$deregisterBackButton=l.registerBackButtonAction(function(){a(s.cancelFilterBar)},300),s.removeFilterBar=function(n){s.removed||(s.removed=!0,t.requestAnimationFrame(function(){g.removeClass("filter-bar-in"),F(),s.hideBackdrop(),a(function(){s.scrollItemsTop(),s.$destroy(),h.remove(),s.cancelFilterBar.$scope=$=k=g=B=v=null,p=!1,(n||e.noop)()},350)}),a(function(){s.container.removeClass("filter-bar-open")},400),s.$deregisterBackButton(),T(),$&&$.off("scroll",x))},s.showFilterBar=function(n){s.removed||(s.container.append(h).addClass("filter-bar-open"),s.scrollItemsTop(),t.requestAnimationFrame(function(){s.removed||a(function(){g.addClass("filter-bar-in"),s.filterText?s.hideBackdrop():(s.focusInput(),s.showBackdrop()),(n||e.noop)()},20,!1)}),$&&$.on("scroll",x))},s.cancelFilterBar=function(){s.removeFilterBar(s.cancel)},s.updateSearch=function(e){s.update(e)},s.showFilterBar(s.done),s.cancelFilterBar.$scope=s,s.cancelFilterBar}}var p=!1,m=e.element(r[0].body),b={theme:s.theme(),transition:s.transition(),back:f.backButton.icon(),clear:s.clear(),search:s.search(),backdrop:s.backdrop(),placeholder:s.placeholder()};return{show:d}}])}(angular,ionic);